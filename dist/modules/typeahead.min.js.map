{"version":3,"sources":["modules/typeahead.js"],"names":["angular","trigger","provider","container","this","defaults","keyboard","html","delay","minLength","filter","limit","autoSelect","comparator","trimValue","KEY_CODES","downArrow","enter","escape","upArrow","$typeahead","options","parentScope","scope","id","$resetMatches","element","controller","config","setAriaActiveDescendant","index","removeAttr","resultId","$generateResultId","attr","$$phase","$root","$activeIndex","$tooltip","$activate","$scope","$$postDigest","activate","$matches","select","$select","evt","$isActive","matches","safeDigest","update","$$rAF","value","$render","$emit","prefixEvent","isDefined","onSelect","$setViewValue","length","isFunction","$viewValue","$getIndex","$onMouseDown","preventDefault","stopPropagation","equals","clientTop","active","offsetTop","clientBottom","highWatermark","scrollTop","Math","children","lowWatermark","clientHeight","keyCode","$isVisible","getElementById","ele","currentTarget","isUndefined","label","$$updateScrollTop","$digest","focus","show","$element","assertDiv","$timeout","on","append","$onKeyDown","ariaLabelledby","hide","off","onKeyUp","which","$isShown","onFocusKeyUp","$onFocusKeyUp","undefined","array","then","TypeaheadFactory","$filter","expression","directive","results","postLink","restrict","forEach","require","link","falseValueRegExp","key","bsKey","charAt","toUpperCase","slice","test","bsOptions","parsedOptions","$parseOptions","typeahead","watchedOptions","$match","$watchCollection","values","watchOptions","replace","trim","$watch","ngModel","newValue","oldValue","$modelValue","valuesFn","selectMode","substring","displayValue","$formatters","push","modelValue","selected","ss","selectionStart","val","selectionEnd","setSelectionRange","sd","isObject","toString","$on","destroy"],"mappings":"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","file":"modules/typeahead.min.js","sourcesContent":["'use strict';\n\nangular.module('mgcrea.ngStrap.typeahead', ['mgcrea.ngStrap.tooltip', 'mgcrea.ngStrap.helpers.parseOptions'])\n\n  .provider('$typeahead', function () {\n\n    var defaults = this.defaults = {\n      animation: 'am-fade',\n      prefixClass: 'typeahead',\n      prefixEvent: '$typeahead',\n      placement: 'bottom-left',\n      templateUrl: 'typeahead/typeahead.tpl.html',\n      trigger: 'focus',\n      container: false,\n      keyboard: true,\n      html: false,\n      delay: 0,\n      minLength: 1,\n      filter: 'bsAsyncFilter',\n      limit: 6,\n      autoSelect: false,\n      comparator: '',\n      trimValue: true\n    };\n\n    var KEY_CODES = {\n      downArrow: 40,\n      enter: 13,\n      escape: 27,\n      upArrow: 38\n    };\n\n    this.$get = function ($window, $rootScope, $tooltip, $$rAF, $timeout) {\n\n      function TypeaheadFactory (element, controller, config) {\n\n        var $typeahead = {};\n\n        // Common vars\n        var options = angular.extend({}, defaults, config);\n\n        $typeahead = $tooltip(element, options);\n\n        var parentScope = config.scope;\n        var scope = $typeahead.$scope;\n        scope.id = options.id;\n\n        scope.$resetMatches = function () {\n          scope.$matches = [];\n          scope.$activeIndex = options.autoSelect ? 0 : -1; // If set to 0, the first match will be highlighted\n        };\n        scope.$resetMatches();\n\n        scope.$activate = function (index) {\n          scope.$$postDigest(function () {\n            $typeahead.activate(index);\n          });\n        };\n\n        scope.$select = function (index, evt) {\n          scope.$$postDigest(function () {\n            $typeahead.select(index);\n          });\n        };\n\n        scope.$isVisible = function () {\n          return $typeahead.$isVisible();\n        };\n\n        scope.$isActive = function isActive (index) {\n          return scope.$activeIndex === index ? true : undefined;\n        };\n\n        // Public methods\n\n        $typeahead.update = function (matches) {\n          scope.$matches = matches;\n          if (scope.$activeIndex >= matches.length) {\n            scope.$activeIndex = options.autoSelect ? 0 : -1;\n          }\n\n          // wrap in a $timeout so the results are updated\n          // before repositioning\n          safeDigest(scope);\n          $$rAF($typeahead.$applyPlacement);\n        };\n\n        $typeahead.activate = function (index) {\n          scope.$activeIndex = index;\n        };\n\n        $typeahead.select = function (index) {\n          if (index === -1) return;\n          var value = scope.$matches[index].value;\n          // console.log('$setViewValue', value);\n          controller.$setViewValue(value);\n          controller.$render();\n          scope.$resetMatches();\n          if (parentScope) parentScope.$digest();\n          // Emit event\n          scope.$emit(options.prefixEvent + '.select', value, index, $typeahead);\n          if (angular.isDefined(options.onSelect) && angular.isFunction(options.onSelect)) {\n            options.onSelect(value, index, $typeahead);\n          }\n        };\n\n        // Protected methods\n\n        $typeahead.$isVisible = function () {\n          if (!options.minLength || !controller) {\n            return !!scope.$matches.length;\n          }\n          // minLength support\n          return scope.$matches.length && angular.isString(controller.$viewValue) && controller.$viewValue.length >= options.minLength;\n        };\n\n        scope.$generateResultId = function (index) {\n          return scope.id ? scope.id + '_typeahead_result_' + index : undefined;\n        };\n\n        $typeahead.$getIndex = function (value) {\n          var index;\n          for (index = scope.$matches.length; index--;) {\n            if (angular.equals(scope.$matches[index].value, value)) break;\n          }\n          return index;\n        };\n\n        $typeahead.$onMouseDown = function (evt) {\n          // Prevent blur on mousedown\n          evt.preventDefault();\n          evt.stopPropagation();\n        };\n\n        $typeahead.$$updateScrollTop = function (container, index) {\n          if (index > -1 && index < container.children.length) {\n            var active = container.children[index];\n            var clientTop = active.offsetTop;\n            var clientBottom = active.offsetTop + active.clientHeight;\n            var highWatermark = container.scrollTop;\n            var lowWatermark = container.scrollTop + container.clientHeight;\n\n            // active entry overlaps top border\n            if (clientBottom >= highWatermark && clientTop < highWatermark) {\n              container.scrollTop = Math.max(0, container.scrollTop - container.clientHeight);\n            } else if (clientBottom > lowWatermark) {\n              // top of active element is invisible because it's below the bottom of the visible container window\n              container.scrollTop = clientTop;\n            }\n          }\n        };\n\n        $typeahead.$onKeyDown = function (evt) {\n          // If the key code isn't up arrow, down arrow, or enter return.\n          if (!/(38|40|13)/.test(evt.keyCode)) return;\n\n          // Let ngSubmit pass if the typeahead tip is hidden or no option is selected\n          if ($typeahead.$isVisible() && !(evt.keyCode === KEY_CODES.enter && scope.$activeIndex === -1)) {\n            evt.preventDefault();\n            evt.stopPropagation();\n          }\n\n          // Select with enter\n          if (evt.keyCode === KEY_CODES.enter && scope.$matches.length) {\n            $typeahead.select(scope.$activeIndex);\n            // Navigate with keyboard\n          } else if (evt.keyCode === KEY_CODES.upArrow && scope.$activeIndex > 0) {\n            scope.$activeIndex--;\n            setAriaActiveDescendant(scope.$activeIndex);\n            angular.element(document.getElementById(options.id + '_sr_text')).html(scope.$matches[scope.$activeIndex].label);\n          } else if (evt.keyCode === KEY_CODES.downArrow && scope.$activeIndex < scope.$matches.length - 1) {\n            scope.$activeIndex++;\n            setAriaActiveDescendant(scope.$activeIndex);\n            angular.element(document.getElementById(options.id + '_sr_text')).html(scope.$matches[scope.$activeIndex].label);\n          } \n          else if ((evt.keyCode === KEY_CODES.upArrow && scope.$activeIndex == 0) || (evt.keyCode === KEY_CODES.downArrow && scope.$activeIndex == scope.$matches.length - 1)) {\n            scope.$activeIndex = -1;\n            var ele = '#' + evt.currentTarget.id;\n            angular.element(ele).val('').val(controller.$viewValue);\n            angular.element(ele).focus();\n          }\n          else if (angular.isUndefined(scope.$activeIndex)) {\n            scope.$activeIndex = 0;\n            setAriaActiveDescendant();\n          }\n\n          // update scrollTop property on $typeahead when scope.$activeIndex is not in visible area\n          $typeahead.$$updateScrollTop($typeahead.$element[0], scope.$activeIndex);\n          scope.$digest();\n        };\n\n        // Overrides\n\n        var show = $typeahead.show;\n        $typeahead.show = function () {\n          show();\n          // use timeout to hookup the events to prevent\n          // event bubbling from being processed immediately.\n          $timeout(function () {\n            if ($typeahead.$element) {\n              if (options.id) {\n                // Set the id on the \"dropdown\" component of the typeahead. The input should \"control\" this element.\n                $typeahead.$element.attr('id', options.id + '_listbox');\n                element.attr('aria-controls', options.id + '_listbox');\n\n                var assertDiv = document.getElementById(options.id + '_sr_text');\n                if (!assertDiv) {\n                  $typeahead.$element.parent().append('<div id=\"' + options.id + '_sr_text\" aria-live=\"assertive\" style=\"position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0;\"></div>');\n                }\n              }\n\n              // If the input was given an aria-labelledby attribute apply it to the \"dropdown\" component.\n              $typeahead.$element.attr('aria-labelledby', options.ariaLabelledby);\n\n              $typeahead.$element.on('mousedown', $typeahead.$onMouseDown);\n              if (options.keyboard) {\n                //event for the element that we attach is added to event queue\n                //before pushing the same event more that once for the same element, event need to detach\n                //list item jumps happening in search list for this setted keydown off\n                if (element) element.off('keydown', $typeahead.$onKeyDown); \n                if (element) element.on('keydown', $typeahead.$onKeyDown);\n              }\n            }\n          }, 0, false);\n        };\n\n        var hide = $typeahead.hide;\n        $typeahead.hide = function () {\n          if ($typeahead.$element) $typeahead.$element.off('mousedown', $typeahead.$onMouseDown);\n          if (options.keyboard) {\n            if (element) element.off('keydown', $typeahead.$onKeyDown);\n          }\n          if (!options.autoSelect) {\n            $typeahead.activate(-1);\n          }\n\n          var assertDiv = document.getElementById(options.id + '_sr_text');\n          angular.element(assertDiv).remove();\n\n          setAriaActiveDescendant();\n\n          hide();\n        };\n\n        var onKeyUp = $typeahead.$onKeyUp; // eslint-disable-line no-unused-vars\n        $typeahead.$onKeyUp = function (evt) {\n          if (evt.which === KEY_CODES.escape && $typeahead.$isShown) {\n            $typeahead.hide();\n            evt.stopPropagation();\n          }\n        };\n\n        var onFocusKeyUp = $typeahead.$onFocusKeyUp; // eslint-disable-line no-unused-vars\n        $typeahead.$onFocusKeyUp = function (evt) {\n          if (evt.which === KEY_CODES.escape) {\n            $typeahead.hide();\n            evt.stopPropagation();\n          }\n        };\n\n        // Helper functions within this closure\n\n        function setAriaActiveDescendant (index) {\n          if (index === undefined || !scope.id) {\n            element.removeAttr('aria-activedescendant');\n          } else {\n            var resultId = scope.$generateResultId(index);\n            if (resultId) {\n              element.attr('aria-activedescendant', resultId);\n            } else {\n              element.removeAttr('aria-activedescendant');\n            }\n          }\n        }\n\n        return $typeahead;\n\n      }\n\n      // Helper functions\n\n      function safeDigest (scope) {\n        /* eslint-disable no-unused-expressions */\n        scope.$$phase || (scope.$root && scope.$root.$$phase) || scope.$digest();\n        /* eslint-enable no-unused-expressions */\n      }\n\n      TypeaheadFactory.defaults = defaults;\n      return TypeaheadFactory;\n\n    };\n\n  })\n\n  .filter('bsAsyncFilter', function ($filter) {\n    return function (array, expression, comparator) {\n      if (array && angular.isFunction(array.then)) {\n        return array.then(function (results) {\n          return $filter('filter')(results, expression, comparator);\n        });\n      }\n      return $filter('filter')(array, expression, comparator);\n    };\n  })\n\n  .directive('bsTypeahead', function ($window, $parse, $q, $typeahead, $parseOptions) {\n\n    var defaults = $typeahead.defaults;\n\n    return {\n      restrict: 'EAC',\n      require: 'ngModel',\n      link: function postLink (scope, element, attr, controller) {\n\n        // Fixes firefox bug when using objects in model with typeahead\n        // Yes this breaks any other directive using a 'change' event on this input,\n        // but if it is using the 'change' event why is it used with typeahead?\n        element.off('change');\n\n        // Directive options\n        var options = {\n          scope: scope\n        };\n        angular.forEach(['template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'container', 'delay', 'trigger', 'keyboard', 'html', 'animation', 'filter', 'limit', 'minLength', 'watchOptions', 'selectMode', 'autoSelect', 'comparator', 'id', 'prefixEvent', 'prefixClass', 'ariaLabelledby'], function (key) {\n          if (angular.isDefined(attr[key])) options[key] = attr[key];\n        });\n\n        // use string regex match boolean attr falsy values, leave truthy values be\n        var falseValueRegExp = /^(false|0|)$/i;\n        angular.forEach(['html', 'container', 'trimValue', 'filter'], function (key) {\n          if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;\n        });\n\n        // bind functions from the attrs to the show, hide and select events\n        angular.forEach(['onBeforeShow', 'onShow', 'onBeforeHide', 'onHide', 'onSelect'], function (key) {\n          var bsKey = 'bs' + key.charAt(0).toUpperCase() + key.slice(1);\n          if (angular.isDefined(attr[bsKey])) {\n            options[key] = scope.$eval(attr[bsKey]);\n          }\n        });\n\n        // Disable browser autocompletion\n        if (!element.attr('autocomplete')) element.attr('autocomplete', 'off');\n\n        // Build proper bsOptions\n        var filter = angular.isDefined(options.filter) ? options.filter : defaults.filter;\n        var limit = options.limit || defaults.limit;\n        var comparator = options.comparator || defaults.comparator;\n\n        var bsOptions = attr.bsOptions;\n        if (filter) {\n          bsOptions += ' | ' + filter + ':$viewValue';\n          if (comparator) bsOptions += ':' + comparator;\n        }\n        if (limit) bsOptions += ' | limitTo:' + limit;\n        var parsedOptions = $parseOptions(bsOptions);\n\n        // Initialize typeahead\n        var typeahead = $typeahead(element, controller, options);\n\n        if (!element.attr('aria-autocomplete') && !bsOptions.templateUrl) {\n          // Per draft spec for a combobox element the aria-auto complete should be set to a list.\n          element.attr('aria-autocomplete', 'list');\n        }\n\n        // Watch options on demand\n        if (options.watchOptions) {\n          // Watch bsOptions values before filtering for changes, drop function calls\n          var watchedOptions = parsedOptions.$match[7].replace(/\\|.+/, '').replace(/\\(.*\\)/g, '').trim();\n          scope.$watchCollection(watchedOptions, function (newValue, oldValue) {\n            // console.warn('scope.$watch(%s)', watchedOptions, newValue, oldValue);\n            parsedOptions.valuesFn(scope, controller).then(function (values) {\n              typeahead.update(values);\n              controller.$render();\n            });\n          });\n        }\n\n        // Watch model for changes\n        scope.$watch(attr.ngModel, function (newValue, oldValue) {\n          // console.warn('$watch', element.attr('ng-model'), newValue);\n          scope.$modelValue = newValue; // Publish modelValue on scope for custom templates\n          parsedOptions.valuesFn(scope, controller)\n            .then(function (values) {\n              // Prevent input with no future prospect if selectMode is truthy\n              // @TODO test selectMode\n              if (options.selectMode && !values.length && newValue.length > 0) {\n                controller.$setViewValue(controller.$viewValue.substring(0, controller.$viewValue.length - 1));\n                return;\n              }\n              if (values.length > limit) values = values.slice(0, limit);\n              typeahead.update(values);\n              // Queue a new rendering that will leverage collection loading\n              controller.$render();\n            });\n        });\n\n        // modelValue -> $formatters -> viewValue\n        controller.$formatters.push(function (modelValue) {\n          // console.warn('$formatter(\"%s\"): modelValue=%o (%o)', element.attr('ng-model'), modelValue, typeof modelValue);\n          var displayValue = parsedOptions.displayValue(modelValue);\n\n          // If we can determine the displayValue, use that\n          if (displayValue) {\n            return displayValue;\n          }\n\n          // If there's no display value, attempt to use the modelValue.\n          // If the model is an object not much we can do\n          if (angular.isDefined(modelValue) && typeof modelValue !== 'object') {\n            return modelValue;\n          }\n          return '';\n        });\n\n        // Model rendering in view\n        controller.$render = function () {\n          // console.warn('$render', element.attr('ng-model'), 'controller.$modelValue', typeof controller.$modelValue, controller.$modelValue, 'controller.$viewValue', typeof controller.$viewValue, controller.$viewValue);\n          if (controller.$isEmpty(controller.$viewValue)) {\n            return element.val('');\n          }\n          var index = typeahead.$getIndex(controller.$modelValue);\n          var selected = index !== -1 ? typeahead.$scope.$matches[index].label : controller.$viewValue;\n          selected = angular.isObject(selected) ? parsedOptions.displayValue(selected) : selected;\n          var value = selected ? selected.toString().replace(/<(?:.|\\n)*?>/gm, '') : '';\n          var ss = element[0].selectionStart;\n          var sd = element[0].selectionEnd;\n          element.val(options.trimValue === false ? value : value.trim());\n          element[0].setSelectionRange(ss, sd);\n        };\n\n        // Garbage collection\n        scope.$on('$destroy', function () {\n          element.off('keydown');\n          if (typeahead) typeahead.destroy();\n          options = null;\n          typeahead = null;\n        });\n\n      }\n    };\n\n  });\n"],"sourceRoot":"/source/"}